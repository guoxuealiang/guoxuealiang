<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Es原理与使用 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1、ElasticSearch基本使用1.1、基本介绍1.1.1、ElasticSearch的特色ElasticSearch是实时的分布式搜索分析引擎，内部使用Lucene做索引与搜索  准实时性：新增到ES中的数据在1秒后就可以被检索到，这种新增数据对搜索的可见性称为”准实时搜索” 分布式：意味着可以动态调整集群规模，弹性扩容 集群规模：可以扩展到上百台服务器，处理PB级结构化或非结构化数据 各">
<meta property="og:type" content="article">
<meta property="og:title" content="Es原理与使用">
<meta property="og:url" content="http://example.com/2022/11/18/Es%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="1、ElasticSearch基本使用1.1、基本介绍1.1.1、ElasticSearch的特色ElasticSearch是实时的分布式搜索分析引擎，内部使用Lucene做索引与搜索  准实时性：新增到ES中的数据在1秒后就可以被检索到，这种新增数据对搜索的可见性称为”准实时搜索” 分布式：意味着可以动态调整集群规模，弹性扩容 集群规模：可以扩展到上百台服务器，处理PB级结构化或非结构化数据 各">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-1.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-2.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-3.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-4.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-5.jpg">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-6.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-7.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-8.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-9.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-10.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-11.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-12.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-13.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-14.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-15.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-16.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-17.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-18.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-19.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-20.png">
<meta property="og:image" content="e:/blog/blog/source_posts/image/es-21.png">
<meta property="article:published_time" content="2022-11-18T01:42:22.000Z">
<meta property="article:modified_time" content="2022-11-21T13:45:43.229Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="e:/blog/blog/source_posts/image/es-1.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Es原理与使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/11/18/Es%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2022-11-18T01:42:22.000Z" itemprop="datePublished">2022-11-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Es原理与使用
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1、ElasticSearch基本使用"><a href="#1、ElasticSearch基本使用" class="headerlink" title="1、ElasticSearch基本使用"></a>1、ElasticSearch基本使用</h2><h3 id="1-1、基本介绍"><a href="#1-1、基本介绍" class="headerlink" title="1.1、基本介绍"></a>1.1、基本介绍</h3><h4 id="1-1-1、ElasticSearch的特色"><a href="#1-1-1、ElasticSearch的特色" class="headerlink" title="1.1.1、ElasticSearch的特色"></a>1.1.1、ElasticSearch的特色</h4><p>ElasticSearch是实时的分布式搜索分析引擎，内部使用Lucene做索引与搜索</p>
<ul>
<li>准实时性：新增到ES中的数据在1秒后就可以被检索到，这种新增数据对搜索的可见性称为”准实时搜索”</li>
<li>分布式：意味着可以动态调整集群规模，弹性扩容</li>
<li>集群规模：可以扩展到上百台服务器，处理PB级结构化或非结构化数据</li>
<li>各节点组成对等的网络结构，某些节点出现故障时会自动分配其他节点代替其工作</li>
</ul>
<p>Lucene是Java语言编写的全文搜索框架，用于处理纯文本的数据，但它只是一个库，提供建立索引、执行搜索等接口，但不包含分布式服务，这些正是 ES 做的</p>
<h4 id="1-1-2-ElasticSearch使用场景"><a href="#1-1-2-ElasticSearch使用场景" class="headerlink" title="1.1.2 ElasticSearch使用场景"></a>1.1.2 ElasticSearch使用场景</h4><p>ElasticSearch广泛应用于各行业领域， 比如维基百科， GitHub的代码搜索，电商网站的大数据日志统计分析， BI系统报表统计分析等。</p>
<ul>
<li><p>提供分布式的搜索引擎和数据分析引擎</p>
<p>比如百度，网站的站内搜索，IT系统的检索， 数据分析比如热点词统计， 电商网站商品TOP排名等。</p>
</li>
<li><p>全文检索，结构化检索，数据分析</p>
<p>支持全文检索， 比如查找包含指定名称的商品信息； 支持结构检索， 比如查找某个分类下的所有商品信息； </p>
<p>还可以支持高级数据分析， 比如统计某个商品的点击次数， 某个商品有多少用户购买等等。</p>
</li>
<li><p>支持海量数据准实时的处理</p>
<p>采用分布式节点， 将数据分散到多台服务器上去存储和检索， 实现海量数据的处理， 比如统计用户的行为日志， 能够在秒级别对数据进行检索和分析。</p>
</li>
</ul>
<h4 id="1-1-3-ElasticSearch基本概念介绍"><a href="#1-1-3-ElasticSearch基本概念介绍" class="headerlink" title="1.1.3 ElasticSearch基本概念介绍"></a>1.1.3 ElasticSearch基本概念介绍</h4><table>
<thead>
<tr>
<th>ElasticSearch</th>
<th>Relational Database</th>
</tr>
</thead>
<tbody><tr>
<td>Index</td>
<td>Database</td>
</tr>
<tr>
<td>Type</td>
<td>Table</td>
</tr>
<tr>
<td>Document</td>
<td>Row</td>
</tr>
<tr>
<td>Field</td>
<td>Column</td>
</tr>
<tr>
<td>Mapping</td>
<td>Schema</td>
</tr>
<tr>
<td>Everything is indexed</td>
<td>Index</td>
</tr>
<tr>
<td>Query DSL</td>
<td>SQL</td>
</tr>
<tr>
<td>GET http://…</td>
<td>SELECT * FROM table…</td>
</tr>
<tr>
<td>PUT http://…</td>
<td>UPDATE table SET…</td>
</tr>
</tbody></table>
<p><img src="E:\blog\blog\source_posts\image\es-1.png" alt="es-1"></p>
<ul>
<li><p>索引（Index)</p>
<p>相比传统的关系型数据库，索引相当于SQL中的一个【数据库】，或者一个数据存储方案(schema)。</p>
</li>
<li><p>类型（Type）</p>
<p>一个索引内部可以定义一个或多个类型， 在传统关系数据库来说， 类型相当于【表】的概念。</p>
</li>
<li><p>文档（Document）</p>
<p>文档是Lucene索引和搜索的原子单位，它是包含了一个或多个域的容器，采用JSON格式表示。相当于传统数据库【行】概念</p>
</li>
<li><p>集群（Cluster）</p>
<p>集群是由一台及以上主机节点组成并提供存储及搜索服务， 多节点组成的集群拥有冗余能力，它可以在一个或几个节点出现故障时保证服务的整体可用性。</p>
</li>
<li><p>节点（Node）</p>
<p>Node为集群中的单台节点，其可以为master节点亦可为slave节点（节点属性由集群内部选举得出）并提供存储相关数据的功能</p>
</li>
<li><p>切片（shards)  分片</p>
<p>切片是把一个大文件分割成多个小文件然后分散存储在集群中的多个节点上， 可以将其看作mysql的分库分表概念。 Shard有两种类型：primary主片和replica副本，primary用于文档存储，Replica shard是Primary Shard的副本，用于冗余数据及提高搜索性能。</p>
<p><img src="E:\blog\blog\source_posts\image\es-2.png" alt="es-2"></p>
</li>
</ul>
<p>注意： ES7之后Type被舍弃，只有Index(等同于数据库+表定义）和Document（文档，行记录）。</p>
<h3 id="1-2-ElasticSearch安装"><a href="#1-2-ElasticSearch安装" class="headerlink" title="1.2 ElasticSearch安装"></a>1.2 ElasticSearch安装</h3><h4 id="1-2-1-下载ElasticSearch服务"><a href="#1-2-1-下载ElasticSearch服务" class="headerlink" title="1.2.1 下载ElasticSearch服务"></a>1.2.1 下载ElasticSearch服务</h4><p>下载最新版ElasticSearch7.10.2： <a target="_blank" rel="noopener" href="https://www.elastic.co/cn/start">https://www.elastic.co/cn/start</a></p>
<h4 id="1-2-2-解压安装包"><a href="#1-2-2-解压安装包" class="headerlink" title="1.2.2 解压安装包"></a>1.2.2 解压安装包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf elasticsearch-7.10.2-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>

<h4 id="1-2-3-创建elsearch用户"><a href="#1-2-3-创建elsearch用户" class="headerlink" title="1.2.3 创建elsearch用户"></a>1.2.3 创建elsearch用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ElasticSearch不能以Root身份运行， 需要单独创建一个用户， 并赋予目录权限</span></span></span><br><span class="line">groupadd elsearch</span><br><span class="line"></span><br><span class="line">useradd elsearch -g elsearch -p elasticsearch</span><br><span class="line"></span><br><span class="line">chown -R elsearch:elsearch  /opt/elasticsearch/elasticsearch-7.10.2</span><br></pre></td></tr></table></figure>

<h4 id="1-2-4-修改配置文件"><a href="#1-2-4-修改配置文件" class="headerlink" title="1.2.4 修改配置文件"></a>1.2.4 修改配置文件</h4><p>vi config/elasticsearch.yml,  默认情况下会绑定本机地址， 外网不能访问， 这里要修改下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># node名称</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span></span><br><span class="line"><span class="comment"># 外网访问地址</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> [<span class="string">&quot;node-1&quot;</span>]</span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> [<span class="string">&quot;node-1&quot;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="1-2-5-关闭防火墙"><a href="#1-2-5-关闭防火墙" class="headerlink" title="1.2.5 关闭防火墙"></a>1.2.5 关闭防火墙</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop  firewalld.service</span><br><span class="line">systemctl disable  firewalld.service</span><br></pre></td></tr></table></figure>

<h4 id="1-2-6-JDK环境变量的配置"><a href="#1-2-6-JDK环境变量的配置" class="headerlink" title="1.2.6 JDK环境变量的配置"></a>1.2.6 JDK环境变量的配置</h4><p>1）最新版的ElasticSearch需要JDK11版本， 下载<a target="_blank" rel="noopener" href="https://download.oracle.com/otn/java/jdk/11.0.4+10/cf1bbcbf431a474eb9fc550051f4ee78/jdk-11.0.4_linux-x64_bin.tar.gz">JDK11压缩包</a>， 并进行解压。</p>
<p>2）修改环境配置文件</p>
<p>vi bin/elasticsearch-env ，参照以下位置， 追加一行， 设置JAVA_HOME， 指定JDK11路径。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/opt/jdk-11.0.11</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">now <span class="built_in">set</span> the path to java</span></span><br><span class="line">if [ ! -z &quot;$JAVA_HOME&quot; ]; then</span><br><span class="line">  JAVA=&quot;$JAVA_HOME/bin/java&quot;</span><br><span class="line">else</span><br><span class="line">  if [ &quot;$(uname -s)&quot; = &quot;Darwin&quot; ]; then</span><br><span class="line">    # OSX has a different structure</span><br><span class="line">    JAVA=&quot;$ES_HOME/jdk/Contents/Home/bin/java&quot;</span><br><span class="line">  else</span><br><span class="line">    JAVA=&quot;$ES_HOME/jdk/bin/java&quot;</span><br><span class="line">  fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h4 id="1-2-7-启动ElasticSearch"><a href="#1-2-7-启动ElasticSearch" class="headerlink" title="1.2.7 启动ElasticSearch"></a>1.2.7 启动ElasticSearch</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 切换用户</span></span></span><br><span class="line">su elsearch</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 以后台常驻方式启动</span></span></span><br><span class="line">bin/elasticsearch -d </span><br></pre></td></tr></table></figure>

<p>PS: 出现max virtual memory areas vm.max_map_count [65530] is too low, increase to at least 错误信息，如图：</p>
<p><img src="E:\blog\blog\source_posts\image\es-3.png" alt="es-3"></p>
<p>修改系统配置：</p>
<p>vi /etc/sysctl.conf , 添加 vm.max_map_count=655360，保存退出后，执行 sysctl -p，使之生效。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure>

<p>vi /etc/security/limits.conf，在文件末尾添加如下配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* soft nofile 65536</span><br><span class="line"></span><br><span class="line">* hard nofile 131072</span><br><span class="line"></span><br><span class="line">* soft nproc 2048</span><br><span class="line"></span><br><span class="line">* hard nproc 4096</span><br><span class="line"></span><br><span class="line">elsearch soft nproc 125535</span><br><span class="line"></span><br><span class="line">elsearch hard nproc 125535</span><br></pre></td></tr></table></figure>

<h4 id="1-2-8-访问验证"><a href="#1-2-8-访问验证" class="headerlink" title="1.2.8 访问验证"></a>1.2.8 访问验证</h4><p>访问地址：<a target="_blank" rel="noopener" href="http://ip:9200/_cat/health">http://ip:9200/_cat/health</a></p>
<p>启动状态有green、yellow和red。 green是代表启动正常。</p>
<p><img src="E:\blog\blog\source_posts\image\es-4.png" alt="es-4"></p>
<h3 id="1-3-Kibana服务安装"><a href="#1-3-Kibana服务安装" class="headerlink" title="1.3 Kibana服务安装"></a>1.3 Kibana服务安装</h3><p>Kibana是一个针对Elasticsearch的开源分析及可视化平台，用来搜索、查看交互存储在Elasticsearch索引中的数据。</p>
<h4 id="1-3-1-下载安装包"><a href="#1-3-1-下载安装包" class="headerlink" title="1.3.1 下载安装包"></a>1.3.1 下载安装包</h4><p>到官网下载， <a target="_blank" rel="noopener" href="https://artifacts.elastic.co/downloads/kibana/kibana-7.10.2-windows-x86_64.zip">Kibana安装包</a>,  与之对应7.10.2版本， 选择Linux 64位版本下载，并进行解压。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压</span></span><br><span class="line">tar -xvf kibana-7.10.2-linux-x86_64.tar.gz</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重命名为 kibana-7.10.2</span></span><br><span class="line">mv kibana-7.10.2-linux-x86_64/ kibana-7.10.2</span><br></pre></td></tr></table></figure>

<h4 id="1-3-2-创建的elsearch用户"><a href="#1-3-2-创建的elsearch用户" class="headerlink" title="1.3.2 创建的elsearch用户"></a>1.3.2 创建的elsearch用户</h4><p>Kibana启动不能使用root用户， 使用上面创建的elsearch用户， 进行赋权：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R elsearch:elsearch kibana-7.10.2</span><br></pre></td></tr></table></figure>

<h4 id="1-3-3-修改配置文件"><a href="#1-3-3-修改配置文件" class="headerlink" title="1.3.3 修改配置文件"></a>1.3.3 修改配置文件</h4><p>vi config/kibana.yml , 修改以下配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务端口</span></span><br><span class="line">server.port: 5601</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务地址</span></span><br><span class="line">server.host: &quot;0.0.0.0&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">elasticsearch服务地址</span></span><br><span class="line">elasticsearch.hosts: [&quot;http://192.168.10.30:9200&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="1-3-4-启动kibana"><a href="#1-3-4-启动kibana" class="headerlink" title="1.3.4 启动kibana"></a>1.3.4 启动kibana</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kibana -q</span><br></pre></td></tr></table></figure>

<p>看到以下日志， 代表启动正常</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log   [01:40:00.143] [info][listening] Server running at http://0.0.0.0:5601</span><br></pre></td></tr></table></figure>

<p>如果出现启动失败的情况， 要检查集群各节点的日志， 确保服务正常运行状态。</p>
<h4 id="1-3-5-访问服务"><a href="#1-3-5-访问服务" class="headerlink" title="1.3.5 访问服务"></a>1.3.5 访问服务</h4><p><a target="_blank" rel="noopener" href="http://ip:5601/app/home#/">http://ip:5601/app/home#/</a></p>
<h3 id="1-4-ES的基础操作"><a href="#1-4-ES的基础操作" class="headerlink" title="1.4 ES的基础操作"></a>1.4 ES的基础操作</h3><h4 id="1-4-1-登录Kibana管理后台"><a href="#1-4-1-登录Kibana管理后台" class="headerlink" title="1.4.1 登录Kibana管理后台"></a>1.4.1 登录Kibana管理后台</h4><p>地址：  <a target="_blank" rel="noopener" href="http://ip:5601/">http://ip:5601</a></p>
<p>进入”Dev Tools”栏，在Console中输入命令进行操作：</p>
<h4 id="1-4-2-索引"><a href="#1-4-2-索引" class="headerlink" title="1.4.2 索引"></a>1.4.2 索引</h4><p>新建索引 orders</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建索引</span></span></span><br><span class="line">PUT orders</span><br></pre></td></tr></table></figure>

<p>2）查询索引 orders</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查询索引</span></span></span><br><span class="line">GET orders</span><br></pre></td></tr></table></figure>

<p>3）删除索引 orders</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 删除索引</span></span></span><br><span class="line">DELETE orders</span><br></pre></td></tr></table></figure>

<p>4）索引的设置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 设置索引</span></span></span><br><span class="line">PUT orders</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &#123;</span><br><span class="line">      &quot;number_of_shards&quot;: 1, </span><br><span class="line">      &quot;number_of_replicas&quot;: 0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-4-3-文档"><a href="#1-4-3-文档" class="headerlink" title="1.4.3 文档"></a>1.4.3 文档</h4><p>1）创建文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建文档，生成默认的文档id</span></span></span><br><span class="line">POST orders/_doc</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;袜子1双&quot;,</span><br><span class="line">  &quot;price&quot;: &quot;200&quot;,</span><br><span class="line">  &quot;count&quot;: 1,</span><br><span class="line">  &quot;address&quot;: &quot;北京市&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建文档，生成自定义文档id</span></span></span><br><span class="line">POST orders/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;袜子1双&quot;,</span><br><span class="line">  &quot;price&quot;: &quot;2&quot;,</span><br><span class="line">  &quot;count&quot;: 1,</span><br><span class="line">  &quot;address&quot;: &quot;北京市&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）查询文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 根据指定的id查询</span></span></span><br><span class="line">GET orders/_doc/1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 根据指定条件查询文档</span></span></span><br><span class="line">GET orders/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;address&quot;: &quot;北京市&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查询全部文档</span></span></span><br><span class="line">GET orders/_search</span><br></pre></td></tr></table></figure>

<p>3） 更新文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 更新文档 覆盖</span></span></span><br><span class="line">POST orders/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;price&quot;: &quot;200&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 更新文档 跟新指定字段值</span></span></span><br><span class="line">POST orders/_update/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;: &#123;</span><br><span class="line">    &quot;price&quot;: &quot;200&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4）删除文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 删除文档</span></span></span><br><span class="line">DELETE orders/_doc/1</span><br></pre></td></tr></table></figure>

<h4 id="1-4-4-映射"><a href="#1-4-4-映射" class="headerlink" title="1.4.4 映射"></a>1.4.4 映射</h4><p>对于映射，只能进行字段添加，不能对字段进行修改或删除，如有需要，则重新创建映射。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 设置mapping信息</span></span></span><br><span class="line">PUT orders/_mappings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;properties&quot;:&#123;</span><br><span class="line">    &quot;price&quot;: &#123;</span><br><span class="line">      &quot;type&quot;: &quot;long&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 设置分片和映射</span></span></span><br><span class="line">PUT orders</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &#123;</span><br><span class="line">      &quot;number_of_shards&quot;: 1, </span><br><span class="line">      &quot;number_of_replicas&quot;: 0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;long&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;count&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;long&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;address&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-5-ES数据类型"><a href="#1-5-ES数据类型" class="headerlink" title="1.5 ES数据类型"></a>1.5 ES数据类型</h3><h4 id="1-5-1-整体数据类型结构"><a href="#1-5-1-整体数据类型结构" class="headerlink" title="1.5.1 整体数据类型结构"></a>1.5.1 整体数据类型结构</h4><p><img src="E:\blog\blog\source_posts\image\es-5.jpg" alt="es-5"></p>
<h4 id="1-5-3-Date时间类型"><a href="#1-5-3-Date时间类型" class="headerlink" title="1.5.3 Date时间类型"></a>1.5.3 Date时间类型</h4><p>数据库里的日期类型需要规范具体的传入格式， ES是可以控制，自适应处理。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ES的Date类型允许可以使用的格式：yyyy-MM-dd</span></span></span><br><span class="line">PUT my_date_index/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">    &quot;date&quot;: &quot;2021-01-01&quot;</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ES的Date类型允许可以使用的格式：yyyy-MM-dd HH:mm:ss</span></span></span><br><span class="line">PUT my_date_index/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">    &quot;date&quot;: &quot;2021-01-01T12:10:30Z&quot;</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ES的Date类型允许可以使用的格式：epoch_millis(毫秒值)</span></span></span><br><span class="line">PUT my_date_index/_doc/3</span><br><span class="line">&#123;</span><br><span class="line">    &quot;date&quot;: 1520071600001</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看日期数据：</span></span></span><br><span class="line">GET my_date_index/_mapping</span><br></pre></td></tr></table></figure>

<h4 id="1-5-4-复合类型"><a href="#1-5-4-复合类型" class="headerlink" title="1.5.4 复合类型"></a>1.5.4 复合类型</h4><p>1）数组</p>
<p>在Elasticsearch中，数组不需要声明专用的字段数据类型。但是，在数组中的所有值都必须具有相同的数据类型。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 错误示例</span></span></span><br><span class="line">POST orders/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;goodsName&quot;:[&quot;足球&quot;,&quot;篮球&quot;,&quot;兵乓球&quot;, 3]</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 正确示例</span></span></span><br><span class="line">POST orders/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;goodsName&quot;:[&quot;足球&quot;,&quot;篮球&quot;,&quot;兵乓球&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）对象</p>
<p>用于存储单个JSON对象， 类似于JAVA中的对象类型， 可以有多个值， 比如LIST，可以包含多个对象。但是，LIST&lt; Object &gt;只能作为整体， 不能独立的索引查询。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新增第一组数据， 组别为美国，两个人。</span></span><br><span class="line">POST my_index/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;group&quot; : &quot;america&quot;,  </span><br><span class="line">  &quot;users&quot; : [   </span><br><span class="line">    &#123;   </span><br><span class="line">      &quot;name&quot; : &quot;John&quot;,  </span><br><span class="line">      &quot;age&quot; :  &quot;22&quot; </span><br><span class="line">    &#125;,  </span><br><span class="line">    &#123;   </span><br><span class="line">      &quot;name&quot; : &quot;Alice&quot;, </span><br><span class="line">      &quot;age&quot; :  &quot;21&quot; </span><br><span class="line">    &#125;   </span><br><span class="line">  ]</span><br><span class="line">&#125;   </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新增第二组数据， 组别为英国， 两个人。</span></span><br><span class="line">POST my_index/_doc/2</span><br><span class="line">&#123;   </span><br><span class="line">  &quot;group&quot; : &quot;england&quot;,  </span><br><span class="line">  &quot;users&quot; : [   </span><br><span class="line">    &#123;   </span><br><span class="line">      &quot;name&quot; : &quot;lucy&quot;,  </span><br><span class="line">      &quot;age&quot; :  &quot;21&quot; </span><br><span class="line">    &#125;,  </span><br><span class="line">    &#123;   </span><br><span class="line">      &quot;name&quot; : &quot;John&quot;,  </span><br><span class="line">      &quot;age&quot; :  &quot;32&quot; </span><br><span class="line">    &#125;   </span><br><span class="line">  ] </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 搜索name为John，age为21的数据</span></span></span><br><span class="line">GET my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;bool&quot;: &#123;</span><br><span class="line">            &quot;must&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;match&quot;: &#123;</span><br><span class="line">                        &quot;users.name&quot;: &quot;John&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;match&quot;: &#123;</span><br><span class="line">                        &quot;users.age&quot;: &quot;21&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果可以看到， 这两组数据都能找出，因为每一组数据都是作为一个整体进行搜索匹配， 而非具体某一条数据。</p>
<p>3）嵌套</p>
<p>用于存储多个JSON对象组成的数组，<code>nested</code> 类型是 <code>object</code> 类型中的一个特例，可以让对象数组独立索引和查询。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 1. 创建nested类型的索引</span></span></span><br><span class="line">PUT my_index</span><br><span class="line">&#123;   </span><br><span class="line">  &quot;mappings&quot;: &#123; </span><br><span class="line">    &quot;properties&quot;: &#123; </span><br><span class="line">      &quot;users&quot;: &#123;    </span><br><span class="line">        &quot;type&quot;: &quot;nested&quot;    </span><br><span class="line">      &#125; </span><br><span class="line">    &#125;   </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 2. 新增数据</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新增第一组数据， 组别为美国，两个人。</span></span><br><span class="line">POST my_index/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;group&quot; : &quot;america&quot;,  </span><br><span class="line">  &quot;users&quot; : [   </span><br><span class="line">    &#123;   </span><br><span class="line">      &quot;name&quot; : &quot;John&quot;,  </span><br><span class="line">      &quot;age&quot; :  &quot;22&quot; </span><br><span class="line">    &#125;,  </span><br><span class="line">    &#123;   </span><br><span class="line">      &quot;name&quot; : &quot;Alice&quot;, </span><br><span class="line">      &quot;age&quot; :  &quot;21&quot; </span><br><span class="line">    &#125;   </span><br><span class="line">  ]</span><br><span class="line">&#125;   </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新增第二组数据， 组别为英国， 两个人。</span></span><br><span class="line">POST my_index/_doc/2</span><br><span class="line">&#123;   </span><br><span class="line">  &quot;group&quot; : &quot;england&quot;,  </span><br><span class="line">  &quot;users&quot; : [   </span><br><span class="line">    &#123;   </span><br><span class="line">      &quot;name&quot; : &quot;lucy&quot;,  </span><br><span class="line">      &quot;age&quot; :  &quot;21&quot; </span><br><span class="line">    &#125;,  </span><br><span class="line">    &#123;   </span><br><span class="line">      &quot;name&quot; : &quot;John&quot;,  </span><br><span class="line">      &quot;age&quot; :  &quot;32&quot; </span><br><span class="line">    &#125;   </span><br><span class="line">  ] </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 3. 再次查询</span></span></span><br><span class="line">GET my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;bool&quot;: &#123;</span><br><span class="line">            &quot;must&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;nested&quot;: &#123;</span><br><span class="line">                        &quot;path&quot;: &quot;users&quot;,</span><br><span class="line">                        &quot;query&quot;: &#123;</span><br><span class="line">                            &quot;bool&quot;: &#123;</span><br><span class="line">                                &quot;must&quot;: [</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        &quot;match&quot;: &#123;</span><br><span class="line">                                            &quot;users.name&quot;: &quot;John&quot;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;,</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        &quot;match&quot;: &#123;</span><br><span class="line">                                            &quot;users.age&quot;: &quot;21&quot;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>采用以前的条件， 这个时候查不到任何结果， 将年龄改成22， 就可以找出对应的数据</p>
<h4 id="1-5-5-GEO地理位置类型"><a href="#1-5-5-GEO地理位置类型" class="headerlink" title="1.5.5 GEO地理位置类型"></a>1.5.5 GEO地理位置类型</h4><p>现在大部分APP都有基于位置搜索的功能， 比如交友、购物应用等。这些功能是基于GEO搜索实现的。</p>
<p>对于GEO地理位置类型，分为地理坐标类型：Geo-point， 和形状：Geo-shape 两种类型。</p>
<table>
<thead>
<tr>
<th align="left">经纬度</th>
<th align="left">英文</th>
<th align="left">简写</th>
<th align="left">正数</th>
<th>负数</th>
</tr>
</thead>
<tbody><tr>
<td align="left">纬度</td>
<td align="left">latitude</td>
<td align="left">lat</td>
<td align="left">北纬</td>
<td>南纬</td>
</tr>
<tr>
<td align="left">经度</td>
<td align="left">longitude</td>
<td align="left">lon或lng</td>
<td align="left">东经</td>
<td>西经</td>
</tr>
</tbody></table>
<p>1）创建地理位置索引</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT my_locations</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;location&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;geo_point&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）添加地理位置数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">采用object对象类型</span></span><br><span class="line">PUT my_locations/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">    &quot;user&quot;: &quot;张三&quot;,</span><br><span class="line">    &quot;text&quot;: &quot;Geo-point as an object&quot;,</span><br><span class="line">    &quot;location&quot;: &#123;</span><br><span class="line">        &quot;lat&quot;: 41.12,</span><br><span class="line">        &quot;lon&quot;: -71.34</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">采用string类型</span></span><br><span class="line">PUT my_locations/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">    &quot;user&quot;: &quot;李四&quot;,</span><br><span class="line">    &quot;text&quot;: &quot;Geo-point as a string&quot;,</span><br><span class="line">    &quot;location&quot;: &quot;45.12,-75.34&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">采用geohash类型（geohash算法可以将多维数据映射为一串字符）</span></span><br><span class="line">PUT my_locations/_doc/3</span><br><span class="line">&#123;</span><br><span class="line">    &quot;user&quot;: &quot;王二麻子&quot;,</span><br><span class="line">    &quot;text&quot;: &quot;Geo-point as a geohash&quot;,</span><br><span class="line">    &quot;location&quot;: &quot;drm3btev3e86&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">采用array数组类型</span></span><br><span class="line">PUT my_locations/_doc/4</span><br><span class="line">&#123;</span><br><span class="line">    &quot;user&quot;: &quot;木头老七&quot;,</span><br><span class="line">    &quot;text&quot;: &quot;Geo-point as an array&quot;,</span><br><span class="line">    &quot;location&quot;: [</span><br><span class="line">        -80.34,</span><br><span class="line">        51.12</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3）需求</p>
<p>搜索出距离我{“lat” : 40,”lon” : -70} 200km范围内的人</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET my_locations/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;bool&quot;: &#123;</span><br><span class="line">            &quot;must&quot;: &#123;</span><br><span class="line">                &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;filter&quot;: &#123;</span><br><span class="line">                &quot;geo_distance&quot;: &#123;</span><br><span class="line">                    &quot;distance&quot;: &quot;200km&quot;,</span><br><span class="line">                    &quot;location&quot;: &#123;</span><br><span class="line">                        &quot;lat&quot;: 40,</span><br><span class="line">                        &quot;lon&quot;: -70</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-ES高可用集群配置"><a href="#2-ES高可用集群配置" class="headerlink" title="2. ES高可用集群配置"></a>2. ES高可用集群配置</h2><h3 id="2-1-集群介绍"><a href="#2-1-集群介绍" class="headerlink" title="2.1 集群介绍"></a>2.1 集群介绍</h3><h4 id="2-1-1-主节点（候选主节点）"><a href="#2-1-1-主节点（候选主节点）" class="headerlink" title="2.1.1 主节点（候选主节点）"></a>2.1.1 主节点（候选主节点）</h4><p><img src="E:\blog\blog\source_posts\image\es-6.png" alt="es-6"></p>
<p>主节点负责创建索引、删除索引、分配分片、追踪集群中的节点状态等工作， 主节点负荷相对较轻， 客户端请求可以直接发往任何节点， 由对应节点负责分发和返回处理结果。</p>
<p>​    一个节点启动之后， 采用 Zen Discovery机制去寻找集群中的其他节点， 并与之建立连接， 集群会从候选主节点中选举出一个主节点， 并且一个集群只能选举一个主节点， 在某些情况下， 由于网络通信丢包等问题， 一个集群可能会出现多个主节点， 称为“脑裂现象”， 脑裂会存在丢失数据的可能， 因为主节点拥有最高权限， 它决定了什么时候可以创建索引， 分片如何移动等， 如果存在多个主节点， 就会产生冲突， 容易产生数据丢失。要尽量避免这个问题， 可以通过 discovery.zen.minimum_master_nodes 来设置最少可工作的候选主节点个数。  建议设置为（候选主节点/2） + 1 比如三个候选主节点，该配置项为 （3/2）+1 ,来保证集群中有半数以上的候选主节点， 没有足够的master候选节点， 就不会进行master节点选举，减少脑裂的可能。</p>
<p>主节点的参数设置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node.master = true</span><br><span class="line">node.data = false</span><br></pre></td></tr></table></figure>

<h4 id="2-1-2-数据节点"><a href="#2-1-2-数据节点" class="headerlink" title="2.1.2 数据节点"></a>2.1.2 数据节点</h4><p><img src="E:\blog\blog\source_posts\image\es-7.png" alt="es-7"></p>
<p>数据节点负责数据的存储和CRUD等具体操作，数据节点对机器配置要求比较高，首先需要有足够的磁盘空间来存储数据，其次数据操作对系统CPU、Memory和IO的性能消耗都很大。通常随着集群的扩大，需要增加更多的数据节点来提高可用性。</p>
<p>数据节点的参数设置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node.master = false</span><br><span class="line">node.data = true</span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-客户端节点"><a href="#2-1-3-客户端节点" class="headerlink" title="2.1.3 客户端节点"></a>2.1.3 客户端节点</h4><p><img src="E:\blog\blog\source_posts\image\es-8.png" alt="es-8"></p>
<p>客户端节点不做候选主节点， 也不做数据节点的节点，只负责请求的分发、汇总等等，增加客户端节点类型更多是为了负载均衡的处理。</p>
<p>客户端节点的参数设置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node.master = false</span><br><span class="line">node.data = false</span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-提取节点（预处理）"><a href="#2-1-4-提取节点（预处理）" class="headerlink" title="2.1.4 提取节点（预处理）"></a>2.1.4 提取节点（预处理）</h4><p><img src="E:\blog\blog\source_posts\image\es-9.png" alt="es-9"></p>
<p>能执行预处理管道，有自己独立的任务要执行， 在索引数据之前可以先对数据做预处理操作， 不负责数据存储也不负责集群相关的事务。</p>
<p>参数设置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node.ingest = true</span><br></pre></td></tr></table></figure>

<h4 id="2-1-5-协调节点"><a href="#2-1-5-协调节点" class="headerlink" title="2.1.5 协调节点"></a>2.1.5 协调节点</h4><p><img src="E:\blog\blog\source_posts\image\es-10.png" alt="es-10"></p>
<p>协调节点，是一种角色，而不是真实的Elasticsearch的节点，不能通过配置项来指定哪个节点为协调节点。集群中的任何节点，都可以充当协调节点的角色。当一个节点A收到用户的查询请求后，会把查询子句分发到其它的节点，然后合并各个节点返回的查询结果，最后返回一个完整的数据集给用户。在这个过程中，节点A扮演的就是协调节点的角色。</p>
<p> ES的一次请求非常类似于Map-Reduce操作。在ES中对应的也是两个阶段，称之为scatter-gather。客户端发出一个请求到集群的任意一个节点，这个节点就是所谓的协调节点，它会把请求转发给含有相关数据的节点(scatter阶段)，这些数据节点会在本地执行请求然后把结果返回给协调节点。协调节点将这些结果汇总(reduce)成一个单一的全局结果集(gather阶段) 。</p>
<h4 id="2-1-6-部落节点"><a href="#2-1-6-部落节点" class="headerlink" title="2.1.6 部落节点"></a>2.1.6 部落节点</h4><p><img src="E:\blog\blog\source_posts\image\es-11.png" alt="es-11"></p>
<p>在多个集群之间充当联合客户端，   它是一个特殊的客户端 ， 可以连接多个集群，在所有连接的集群上执行搜索和其他操作。  部落节点从所有连接的集群中检索集群状态并将其合并成全局集群状态。 掌握这一信息，就可以对所有集群中的节点执行读写操作，就好像它们是本地的。 请注意，部落节点需要能够连接到每个配置的集群中的每个单个节点。 </p>
<h3 id="2-2-集群原理"><a href="#2-2-集群原理" class="headerlink" title="2.2 集群原理"></a>2.2 集群原理</h3><h4 id="2-2-1-集群分布式原理"><a href="#2-2-1-集群分布式原理" class="headerlink" title="2.2.1 集群分布式原理"></a>2.2.1 集群分布式原理</h4><p>集群可以根据节点数， 动态调整主分片与副本数， 做到整个集群有效均衡负载。</p>
<p>单节点状态下：</p>
<p><img src="E:\blog\blog\source_posts\image\es-12.png" alt="es-12"></p>
<p>两个节点状态下， 副本数为1：</p>
<p><img src="E:\blog\blog\source_posts\image\es-13.png" alt="es-13"></p>
<p>三个节点状态下， 副本数为1：</p>
<p><img src="E:\blog\blog\source_posts\image\es-14.png" alt="es-14"></p>
<p>三个节点状态下， 副本数为2：</p>
<p><img src="E:\blog\blog\source_posts\image\es-15.png" alt="es-15"></p>
<h4 id="2-2-2-分片处理机制"><a href="#2-2-2-分片处理机制" class="headerlink" title="2.2.2 分片处理机制"></a>2.2.2 分片处理机制</h4><p>设置分片大小的时候， 需预先做好容量规划， 如果节点数过多， 分片数过少， 那么新的节点将无法分片， 不能做到水平扩展， 并且单个分片数据量太大， 导致数据重新分配耗时过长。</p>
<p> 假设一个集群中有一个主节点、两个数据节点。orders索引的分片分布情况如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT orders</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;:&#123;</span><br><span class="line">        &quot;number_of_shards&quot;: 2,  ## 主分片一共 2</span><br><span class="line">        &quot;number_of_replicas&quot;: 2  ## 副分片一共 4</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>整个集群中存在P0和P1两个主分片， P0对应的两个R0副本分片， P1对应的是两个R1副本分片。</p>
<p><img src="E:\blog\blog\source_posts\image\es-16.png" alt="es-16"></p>
<h4 id="2-2-3-写索引处理流程"><a href="#2-2-3-写索引处理流程" class="headerlink" title="2.2.3 写索引处理流程"></a>2.2.3 写索引处理流程</h4><p>1）客户端向NODE1发送写请求。</p>
<p>2）NODE1使用文档ID来确定文档属于分片0，通过集群状态中的内容路由表信息获知分片0的主分片位于NODE3，因此请求被转发到NODE3上。</p>
<p>3）NODE3上的主分片执行写操作。如果写入成功，则它将请求并行转发到 NODE1和NODE2的副分片上，等待返回结果。当所有的副分片都报告成功，NODE3将向协调节点报告成功，协调节点再向客户端报告成功。</p>
<p><img src="E:\blog\blog\source_posts\image\es-17.png" alt="es-17"></p>
<h4 id="2-2-4-读取索引处理流程"><a href="#2-2-4-读取索引处理流程" class="headerlink" title="2.2.4 读取索引处理流程"></a>2.2.4 读取索引处理流程</h4><p>1）客户端向NODE1发送读请求。</p>
<p>2）NODE1使用文档ID来确定文档属于分片0，通过集群状态中的内容路由表信息获知分片0有三个副本数据，位于所有的三个节点中，此时它可以将请求发送到任意节点，这里它将请求转发到NODE2。</p>
<p>3）NODE2将文档返回给 NODE1,NODE1将文档返回给客户端。</p>
<p>NODE1作为协调节点，会将客户端请求轮询发送到集群的所有副本来实现负载均衡。</p>
<p><img src="E:\blog\blog\source_posts\image\es-18.png" alt="es-18"></p>
<h3 id="2-3-集群部署规划"><a href="#2-3-集群部署规划" class="headerlink" title="2.3 集群部署规划"></a>2.3 集群部署规划</h3><p>准备一台虚拟机：</p>
<p>ip： node1 （节点一）,  端口：9200， 9300</p>
<p>ip： node2 （节点二），端口：9201， 9301</p>
<p>ip： node3 （节点三），端口：9202， 9302</p>
<h3 id="2-4-集群配置"><a href="#2-4-集群配置" class="headerlink" title="2.4 集群配置"></a>2.4 集群配置</h3><h4 id="2-4-1-下载安装包"><a href="#2-4-1-下载安装包" class="headerlink" title="2.4.1 下载安装包"></a>2.4.1 下载安装包</h4><p>下载最新版ElasticSearch7.10.2： <a target="_blank" rel="noopener" href="https://www.elastic.co/cn/start">https://www.elastic.co/cn/start</a></p>
<h4 id="2-4-2-解压安装包"><a href="#2-4-2-解压安装包" class="headerlink" title="2.4.2 解压安装包"></a>2.4.2 解压安装包</h4><p>将安装包解压至/opt/elasticsearch/cluster目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/elasticsearch/cluster</span><br><span class="line">cd /opt/elasticsearch/cluster</span><br><span class="line">tar -xvf elasticsearch-7.10.2-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure>

<h4 id="2-4-3-修改集群配置文件"><a href="#2-4-3-修改集群配置文件" class="headerlink" title="2.4.3 修改集群配置文件"></a>2.4.3 修改集群配置文件</h4><p>vi node1/config/elasticsearch.yml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">集群名称</span></span><br><span class="line">cluster.name: my-application</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">节点名称</span></span><br><span class="line">node.name: node-1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">绑定IP地址</span></span><br><span class="line">network.host: 192.168.10.30</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定服务访问端口</span></span><br><span class="line">http.port: 9200</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定API端户端调用端口</span></span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群通讯地址</span></span><br><span class="line">discovery.seed_hosts: [&quot;192.168.10.30:9300&quot;, &quot;192.168.10.30:9301&quot;,&quot;192.168.10.30:9302&quot;]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群初始化能够参选的节点信息</span></span><br><span class="line">cluster.initial_master_nodes: [&quot;192.168.10.30:9300&quot;, &quot;192.168.10.30:9301&quot;,&quot;192.168.10.30:9302&quot;]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启跨域访问支持，默认为<span class="literal">false</span></span></span><br><span class="line">http.cors.enabled: true</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#跨域访问允许的域名, 允许所有域名</span></span></span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改目录权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R elsearch:elsearch /opt/elasticsearch/cluster/node1</span><br></pre></td></tr></table></figure>

<h4 id="2-4-4-创建其余两个节点"><a href="#2-4-4-创建其余两个节点" class="headerlink" title="2.4.4 创建其余两个节点"></a>2.4.4 创建其余两个节点</h4><p>复制node1安装目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/elasticsearch/cluster</span><br><span class="line">cp -r node1 node2</span><br><span class="line">cp -r node1 node3</span><br></pre></td></tr></table></figure>

<h4 id="2-4-5-修改其余节点的配置"><a href="#2-4-5-修改其余节点的配置" class="headerlink" title="2.4.5 修改其余节点的配置"></a>2.4.5 修改其余节点的配置</h4><p>1）node2节点配置内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">集群名称</span></span><br><span class="line">cluster.name: my-application</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">节点名称</span></span><br><span class="line">node.name: node-2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">绑定IP地址</span></span><br><span class="line">network.host: 192.168.10.30</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定服务访问端口</span></span><br><span class="line">http.port: 9201</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定API端户端调用端口</span></span><br><span class="line">transport.tcp.port: 9301</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群通讯地址</span></span><br><span class="line">discovery.seed_hosts: [&quot;192.168.10.30:9300&quot;, &quot;192.168.10.30:9301&quot;,&quot;192.168.10.30:9302&quot;]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群初始化能够参选的节点信息</span></span><br><span class="line">cluster.initial_master_nodes: [&quot;192.168.10.30:9300&quot;, &quot;192.168.10.30:9301&quot;,&quot;192.168.10.30:9302&quot;]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启跨域访问支持，默认为<span class="literal">false</span></span></span><br><span class="line">http.cors.enabled: true</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#跨域访问允许的域名, 允许所有域名</span></span></span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2）node3节点配置内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">集群名称</span></span><br><span class="line">cluster.name: my-application</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">节点名称</span></span><br><span class="line">node.name: node-3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">绑定IP地址</span></span><br><span class="line">network.host: 192.168.10.30</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定服务访问端口</span></span><br><span class="line">http.port: 9202</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定API端户端调用端口</span></span><br><span class="line">transport.tcp.port: 9302</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群通讯地址</span></span><br><span class="line">discovery.seed_hosts: [&quot;192.168.10.30:9300&quot;, &quot;192.168.10.30:9301&quot;,&quot;192.168.10.30:9302&quot;]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群初始化能够参选的节点信息</span></span><br><span class="line">cluster.initial_master_nodes: [&quot;192.168.10.30:9300&quot;, &quot;192.168.10.30:9301&quot;,&quot;192.168.10.30:9302&quot;]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启跨域访问支持，默认为<span class="literal">false</span></span></span><br><span class="line">http.cors.enabled: true</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#跨域访问允许的域名, 允许所有域名</span></span></span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-6-启动集群节点"><a href="#2-4-6-启动集群节点" class="headerlink" title="2.4.6 启动集群节点"></a>2.4.6 启动集群节点</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 切换elsearch用户</span></span></span><br><span class="line">su elsearch</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 分别启动三个ES服务</span></span></span><br><span class="line">/opt/elasticsearch/cluster/node1/bin/elasticsearch -d</span><br><span class="line">/opt/elasticsearch/cluster/node2/bin/elasticsearch -d</span><br><span class="line">/opt/elasticsearch/cluster/node3/bin/elasticsearch -d</span><br></pre></td></tr></table></figure>

<p>注意： 如果启动出现错误， 将各节点的data目录清空， 再重启服务。</p>
<h4 id="2-4-7-集群状态查看"><a href="#2-4-7-集群状态查看" class="headerlink" title="2.4.7 集群状态查看"></a>2.4.7 集群状态查看</h4><p><a target="_blank" rel="noopener" href="http://192.168.10.30:9200/_cat/nodes?pretty">http://192.168.10.30:9200/_cat/nodes?pretty</a></p>
<p>可以看到三个节点信息，三个节点会自行选举出主节点。</p>
<h3 id="2-5-集群分片测试"><a href="#2-5-集群分片测试" class="headerlink" title="2.5 集群分片测试"></a>2.5 集群分片测试</h3><h4 id="2-5-1-修改kibana配置"><a href="#2-5-1-修改kibana配置" class="headerlink" title="2.5.1 修改kibana配置"></a>2.5.1 修改kibana配置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch.hosts: [&quot;http://192.168.10.30:9200&quot;,&quot;http://192.168.10.30:9201&quot;,&quot;http://192.168.10.30:9202&quot;]</span><br></pre></td></tr></table></figure>

<p>重启kibana服务， 进入控制台：<a target="_blank" rel="noopener" href="http://192.168.10.30:5601/app/home#/">http://192.168.10.30:5601/app/home#/</a></p>
<h4 id="2-5-2-设置分片数"><a href="#2-5-2-设置分片数" class="headerlink" title="2.5.2 设置分片数"></a>2.5.2 设置分片数</h4><p>1）2个主分片、2个副分片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## 再次创建索引（副本数量范围内）</span><br><span class="line">PUT orders</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &#123;</span><br><span class="line">            &quot;number_of_shards&quot;: 2,</span><br><span class="line">            &quot;number_of_replicas&quot;: 2</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果正常：</p>
<p><img src="E:\blog\blog\source_posts\image\es-19.png" alt="es-19"></p>
<p>2）2个主分片、5个副分片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT orders</span><br><span class="line">&#123;</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &#123;</span><br><span class="line">            &quot;number_of_shards&quot;: 2,</span><br><span class="line">            &quot;number_of_replicas&quot;: 5</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>yellow警告错误：</p>
<p><img src="E:\blog\blog\source_posts\image\es-20.png" alt="es-20"></p>
<h4 id="2-5-3-分片设置总结"><a href="#2-5-3-分片设置总结" class="headerlink" title="2.5.3 分片设置总结"></a>2.5.3 分片设置总结</h4><p>集群并非可以随意增加副本数量</p>
<h2 id="3-ELK部署应用与工作机制"><a href="#3-ELK部署应用与工作机制" class="headerlink" title="3. ELK部署应用与工作机制"></a>3. ELK部署应用与工作机制</h2><h3 id="3-1-ELK日志分析平台介绍"><a href="#3-1-ELK日志分析平台介绍" class="headerlink" title="3.1 ELK日志分析平台介绍"></a>3.1 ELK日志分析平台介绍</h3><h2 id="4-ElasticSearch高阶操作"><a href="#4-ElasticSearch高阶操作" class="headerlink" title="4. ElasticSearch高阶操作"></a>4. ElasticSearch高阶操作</h2><h3 id="4-1-SpringBoot整合ES"><a href="#4-1-SpringBoot整合ES" class="headerlink" title="4.1 SpringBoot整合ES"></a>4.1 SpringBoot整合ES</h3><p>1）依赖的引入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- elasticsearch--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2）ESConfig连接配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;elasticsearch&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ESConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHost</span><span class="params">(String host)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPort</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPort</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * es java客户端</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestHighLevelClient <span class="title function_">restHighLevelClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RestClientBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(host, port, <span class="string">&quot;http&quot;</span>));</span><br><span class="line">        builder.setRequestConfigCallback(requestConfigBuilder -&gt; &#123;</span><br><span class="line">            requestConfigBuilder.setConnectionRequestTimeout(<span class="number">500000</span>);</span><br><span class="line">            requestConfigBuilder.setSocketTimeout(<span class="number">500000</span>);</span><br><span class="line">            requestConfigBuilder.setConnectTimeout(<span class="number">500000</span>);</span><br><span class="line">            <span class="keyword">return</span> requestConfigBuilder;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(builder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-倒排索引"><a href="#4-2-倒排索引" class="headerlink" title="4.2 倒排索引"></a>4.2 倒排索引</h3><h4 id="4-2-1-概念"><a href="#4-2-1-概念" class="headerlink" title="4.2.1 概念"></a>4.2.1 概念</h4><p>要想理解倒排索引，首先先思考一个问题，获取某个文件夹下所有文件名中包含Spring的文件</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1）确定要搜索的文件夹</span><br><span class="line">2）遍历文件夹下所有文件</span><br><span class="line">3）判断文件名中是否包含Spring</span><br></pre></td></tr></table></figure>

<p>这种思维可以理解为是一种正向思维的方式，从外往内，根据key找value。这种方式可以理解为正向索引。</p>
<h4 id="4-2-2-结构"><a href="#4-2-2-结构" class="headerlink" title="4.2.2 结构"></a>4.2.2 结构</h4><p>而ElasticSearch为了提升查询效率，采用反向思维方式，根据value找key。</p>
<p><img src="E:\blog\blog\source_posts\image\es-21.png" alt="es-21"></p>
<h3 id="4-3-IK分词器"><a href="#4-3-IK分词器" class="headerlink" title="4.3 IK分词器"></a>4.3 IK分词器</h3><h4 id="4-3-1-认识分词器"><a href="#4-3-1-认识分词器" class="headerlink" title="4.3.1 认识分词器"></a>4.3.1 认识分词器</h4><p>查询出了很多万豪相关的酒店，现在以<code>北京市东城区万豪酒店</code>查询name域，可以发现无法查询到结果。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;北京市东城区万豪酒店&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MySQL [elasticsearch_db]&gt; select * from t_hotel where name = &#x27;北京市东城区万豪酒店&#x27; \G;]</span><br></pre></td></tr></table></figure>

<p>在创建索引时，对于name域，数据类型是<code>text</code>。当添加文档时，对于该域的值会进行分词，形成若干term（词条）存储在倒排索引中。</p>
<p>根据倒排索引结构，当查询条件在词条中存在，则会查询到数据。如果词条中没有，则查询不到数据。</p>
<p>那么对于<code>北京市东城区万豪酒店</code>的分词结果是什么呢？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">GET hotel/_analyze</span><br><span class="line">&#123;</span><br><span class="line"> &quot;field&quot;: &quot;name&quot;,  </span><br><span class="line">  &quot;text&quot;: &quot;北京市东城区万豪酒店&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET hotel/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;field&quot;: &quot;name&quot;, </span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;北京市东城区万豪酒店&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;北京市东城区万豪酒店&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;北京市东城区万豪酒店&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时可以发现，每个字形成了一个词，所以并没有找到相匹配的词，导致无法查询到结果</p>
<p>在ElasticSearch默认内置了多种分词器：</p>
<ul>
<li><strong>Standard Analyzer</strong> - 默认分词器，按英文空格切分 </li>
<li>Simple Analyzer - 按照非字母切分(符号被过滤)</li>
<li>Stop Analyzer - 小写处理，停用词过滤(the,a,is) </li>
<li>Whitespace Analyzer - 按照空格切分，不转小写 </li>
<li>Keyword Analyzer - 不分词，直接将输入当作输出 </li>
<li>Patter Analyzer - 正则表达式，默认\W+(非字符分割) </li>
</ul>
<p>而我们想要的是，分词器能够智能的将中文按照词义分成若干个有效的词。此时就需要额外安装中文分词器。 对于中文分词器的类型也有很多，其中首选的是：IK分词器。</p>
<h4 id="4-3-2-安装IK分词器"><a href="#4-3-2-安装IK分词器" class="headerlink" title="4.3.2 安装IK分词器"></a>4.3.2 安装IK分词器</h4><p>1）安装IK分词插件</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.10.2/elasticsearch-analysis-ik-7.10.2.zip">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.10.2/elasticsearch-analysis-ik-7.10.2.zip</a></p>
<p>2）采用本地文件安装方式， 进入ES安装目录， 执行插件安装命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@linux30 cluster]# ./node1/bin/elasticsearch-plugin install file:///opt/elasticsearch/elasticsearch-analysis-ik-7.10.2.zip</span><br><span class="line">[root@linux30 cluster]# ./node2/bin/elasticsearch-plugin install file:///opt/elasticsearch/elasticsearch-analysis-ik-7.10.2.zip</span><br><span class="line">[root@linux30 cluster]# ./node3/bin/elasticsearch-plugin install file:///opt/elasticsearch/elasticsearch-analysis-ik-7.10.2.zip</span><br></pre></td></tr></table></figure>

<p>安装成功后， 会给出对应提示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Installing file:///usr/local/elasticsearch-7.10.2/elasticsearch-analysis-ik-7.10.2.zip</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Downloading file:///usr/local/elasticsearch-7.10.2/elasticsearch-analysis-ik-7.10.2.zip</span></span><br><span class="line">[=================================================] 100%   </span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@     WARNING: plugin requires additional permissions     @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">* java.net.SocketPermission * connect,resolve</span><br><span class="line">See http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html</span><br><span class="line">for descriptions of what these permissions allow and the associated risks.</span><br><span class="line"></span><br><span class="line">Continue with installation? [y/N]y</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Installed analysis-ik</span></span><br></pre></td></tr></table></figure>

<p>3）重启ElasticSearch服务</p>
<h4 id="4-3-3-测试IK分词器"><a href="#4-3-3-测试IK分词器" class="headerlink" title="4.3.3 测试IK分词器"></a>4.3.3 测试IK分词器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># standard标准分词器</span></span></span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;北京市东城区万豪酒店&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># IK智能化分词器</span></span></span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;北京市东城区万豪酒店&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ik_max_word最大化分词</span></span></span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;北京市东城区万豪酒店&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-3-4-IK分词器最佳运用"><a href="#4-3-4-IK分词器最佳运用" class="headerlink" title="4.3.4 IK分词器最佳运用"></a>4.3.4 IK分词器最佳运用</h4><p>analyzer指定的是构建索引的分词，search_analyzer指定的是搜索关键字的分词。</p>
<p>实践运用的时候， 构建索引的时候采用max_word，将分词最大化； 查询的时候则使用smartword智能化分词，这样能够最大程度的匹配出结果。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">PUT hotel</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 1,</span><br><span class="line">    &quot;number_of_replicas&quot;: 0</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      </span><br><span class="line">      &quot;name&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;address&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;analyzer&quot;: &quot;ik_max_word&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;brand&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;type&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">       &quot;price&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;specs&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">       &quot;salesVolume&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;area&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">        &quot;search_analyzer&quot;:&quot;ik_smart&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;imageUrl&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;synopsis&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;analyzer&quot;: &quot;ik_max_word&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;createTime&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;date&quot;,</span><br><span class="line">        &quot;format&quot;: &quot;yyyy-MM-dd&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;isAd&quot;:&#123;</span><br><span class="line">        &quot;type&quot;:&quot;integer&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-3-5-自定义扩展词、停用词"><a href="#4-3-5-自定义扩展词、停用词" class="headerlink" title="4.3.5 自定义扩展词、停用词"></a>4.3.5 自定义扩展词、停用词</h4><p>1）编辑 IKAnalyzer.cfg.xml文件，配置自定义扩展词 my_ext.dic 和 停用词 my_stopword.dic。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@linux30 cluster]# cat node1/config/analysis-ik/IKAnalyzer.cfg.xml</span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">properties</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">comment</span>&gt;</span>IK Analyzer 扩展配置<span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_dict&quot;</span>&gt;</span>my_ext.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;ext_stopwords&quot;</span>&gt;</span>my_stopword.dic<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;entry key=&quot;remote_ext_dict&quot;&gt;words_location&lt;/entry&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">[root@linux30 cluster]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2）创建 my_ext.dic 和 my_stopword.dic</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@linux30 cluster]# vi node1/config/analysis-ik/my_ext.dic</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 添加如下内容</span></span></span><br><span class="line">我爱我的祖国</span><br><span class="line">[root@linux30 cluster]# vi node1/config/analysis-ik/my_stopword.dic</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 添加如下内容</span></span></span><br><span class="line">祖国</span><br></pre></td></tr></table></figure>

<p>3）只需要重启node1节点即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 分词验证</span></span></span><br><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;我爱我的祖国&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 返回结果：</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;我爱我的祖国&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 6,</span><br><span class="line">      &quot;type&quot; : &quot;CN_WORD&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-4-基础查询"><a href="#4-4-基础查询" class="headerlink" title="4.4 基础查询"></a>4.4 基础查询</h3><h4 id="4-4-1-查询所有酒店信息"><a href="#4-4-1-查询所有酒店信息" class="headerlink" title="4.4.1 查询所有酒店信息"></a>4.4.1 查询所有酒店信息</h4><p>match_all</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## 查询所有酒店</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-2-分页查询酒店列表"><a href="#4-4-2-分页查询酒店列表" class="headerlink" title="4.4.2 分页查询酒店列表"></a>4.4.2 分页查询酒店列表</h4><p>from：从哪开始</p>
<p>size：查询条数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## 分页查询酒店列表</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 5</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-3-品牌精确搜索"><a href="#4-4-3-品牌精确搜索" class="headerlink" title="4.4.3 品牌精确搜索"></a>4.4.3 品牌精确搜索</h4><p>term：不会对查询条件进行分词</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## 展示出&quot;万豪&quot;品牌下的所有酒店信息</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;brand&quot;: &quot;万豪&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-4-酒店名称分词查询"><a href="#4-4-4-酒店名称分词查询" class="headerlink" title="4.4.4 酒店名称分词查询"></a>4.4.4 酒店名称分词查询</h4><p>matchQuery会对查询条件进行分词</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## 酒店名称分词查询</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;match&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &quot;北京市东城区瑞麟湾酒店&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-5-酒店品牌模糊搜索"><a href="#4-4-5-酒店品牌模糊搜索" class="headerlink" title="4.4.5 酒店品牌模糊搜索"></a>4.4.5 酒店品牌模糊搜索</h4><p>wildcard：不会对查询条件进行分词。还可以使用通配符 ?（任意单个字符） 和  * （0个或多个字符）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## 酒店品牌模糊搜索</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;wildcard&quot;: &#123;</span><br><span class="line">            &quot;brand&quot;: &quot;万*&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-6-多域搜索"><a href="#4-4-6-多域搜索" class="headerlink" title="4.4.6 多域搜索"></a>4.4.6 多域搜索</h4><p>queryStringQuery：可以指定多个域、会对搜索条件分词、将分词后的搜索条件与term匹配、取结果并集OR、交集AND</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">## 多域搜索</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;query_string&quot;: &#123;</span><br><span class="line">            &quot;fields&quot;: [&quot;name&quot;, &quot;address&quot;, &quot;area&quot;, &quot;synopsis&quot;],</span><br><span class="line">            &quot;query&quot;: &quot;spa OR 商务&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-7-销量排序搜索-sort"><a href="#4-4-7-销量排序搜索-sort" class="headerlink" title="4.4.7 销量排序搜索 sort"></a>4.4.7 销量排序搜索 sort</h4><p>order: asc升序 或 desc降序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## 销量排序</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;sort&quot;: &#123;</span><br><span class="line">        &quot;salesVolume&quot;: &#123;</span><br><span class="line">            &quot;order&quot;: &quot;asc&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-8-价格范围搜索"><a href="#4-4-8-价格范围搜索" class="headerlink" title="4.4.8  价格范围搜索"></a>4.4.8  价格范围搜索</h4><p>range: gt 大于、gte 大于等于、 lt 小于、lte 小于等于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">## 价格范围搜索</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">            &quot;price&quot;: &#123;</span><br><span class="line">                &quot;gte&quot;: 600,</span><br><span class="line">                &quot;lt&quot;: 1600</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-9-自动纠错搜索"><a href="#4-4-9-自动纠错搜索" class="headerlink" title="4.4.9 自动纠错搜索"></a>4.4.9 自动纠错搜索</h4><p>fuzzyQuery：自动尝试将条件纠错，并和词条匹配、fuzziness 允许对几个字进行纠错、prefix_length 设置前几个字符不允许编辑</p>
<p>在未经处理的情况下，一旦条件存在错别字，找不到term，则无法查询到结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">## 正常搜索</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">       &quot;term&quot;: &#123;</span><br><span class="line">           &quot;area&quot;: &quot;北京市&quot;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">## 错别字 经</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">       &quot;term&quot;: &#123;</span><br><span class="line">           &quot;area&quot;: &quot;北经市&quot;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">## 自动纠错搜索 经</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">      &quot;fuzzy&quot;: &#123;</span><br><span class="line">        &quot;area&quot;: &#123;</span><br><span class="line">          &quot;fuzziness&quot;: 1,</span><br><span class="line">          &quot;prefix_length&quot;: 1,</span><br><span class="line">          &quot;value&quot;: &quot;北经市&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-10-搜索结果高亮显示"><a href="#4-4-10-搜索结果高亮显示" class="headerlink" title="4.4.10 搜索结果高亮显示"></a>4.4.10 搜索结果高亮显示</h4><p>highlight：如需将搜索条件以高亮形式展示，则需要在查询时，设置需要对哪一个域以何种样式进行展示，fields 设置要对哪个域高亮、pre_tags 设置高亮样式前缀、post_tags 设置高亮样式后缀</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">       &quot;term&quot;: &#123;</span><br><span class="line">           &quot;name&quot;: &quot;新乐&quot;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;highlight&quot;: &#123;</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">            &quot;name&quot;: &#123;</span><br><span class="line">                &quot;pre_tags&quot;: &quot;&lt;font color=&#x27;red&#x27;&gt;&quot;,</span><br><span class="line">                &quot;post_tags&quot;: &quot;&lt;/font&gt;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-bool查询"><a href="#4-5-bool查询" class="headerlink" title="4.5 bool查询"></a>4.5 bool查询</h3><p>boolQuery:  对多个查询条件拼接、must（and）条件必须成立、must_not （not）条件必须不成立、should（or）条件可以成立、filter 条件过滤，必须成立</p>
<h4 id="4-5-1-must"><a href="#4-5-1-must" class="headerlink" title="4.5.1 must"></a>4.5.1 must</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## must单独使用 品牌必须是万豪，地区必须是北京市</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;bool&quot;: &#123;</span><br><span class="line">            &quot;must&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                   &quot;term&quot;: &#123;</span><br><span class="line">                        &quot;brand&quot;: &quot;万豪&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                    &quot;term&quot;: &#123;</span><br><span class="line">                        &quot;area&quot;: &quot;北京市&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-5-2-filter"><a href="#4-5-2-filter" class="headerlink" title="4.5.2 filter"></a>4.5.2 filter</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## filter单独使用 </span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;bool&quot;: &#123;</span><br><span class="line">            &quot;filter&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;term&quot;: &#123;</span><br><span class="line">                         &quot;brand&quot;: &quot;万豪&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                    &quot;term&quot;: &#123;</span><br><span class="line">                        &quot;area&quot;: &quot;北京市&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-5-3-must和filter组合使用"><a href="#4-5-3-must和filter组合使用" class="headerlink" title="4.5.3 must和filter组合使用"></a>4.5.3 must和filter组合使用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">## must和filter组合使用 品牌为万豪下的，地区为北京市、价格范围在500和2000之间的酒店</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;bool&quot;: &#123;</span><br><span class="line">            &quot;must&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                   &quot;term&quot;: &#123;</span><br><span class="line">                        &quot;brand&quot;: &quot;万豪&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            &quot;filter&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;term&quot;: &#123;</span><br><span class="line">                        &quot;area&quot;: &quot;北京市&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,&#123;</span><br><span class="line">                    &quot;range&quot;: &#123;</span><br><span class="line">                        &quot;price&quot;: &#123;</span><br><span class="line">                            &quot;gte&quot;: 500,</span><br><span class="line">                            &quot;lte&quot;: 2000</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-聚合查询"><a href="#4-6-聚合查询" class="headerlink" title="4.6 聚合查询"></a>4.6 聚合查询</h3><p>聚合介绍：在MySQL中提供了许多聚合函数，如max、min、avg、count等。并且也提供了分组实现group by。对于这些功能，在es中同样提供，主要用于对数据统计分析。</p>
<p>ES中的聚合搜索分为两类：指标聚合、桶聚合</p>
<p>指标聚合：如max、min、sum等。作用等同MySQL中相关聚合函数</p>
<p>桶聚合：用于数据分组，作用等同于MySQL中的group by。</p>
<p>ps：不能对Text类型分组，因为会分词。</p>
<h4 id="4-6-1-指标聚合"><a href="#4-6-1-指标聚合" class="headerlink" title="4.6.1 指标聚合"></a>4.6.1 指标聚合</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">## 统计品牌为万豪下最贵酒店价格</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">       &quot;term&quot;: &#123;</span><br><span class="line">           &quot;brand&quot;: &quot;万豪&quot;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;my_max_price&quot;: &#123;</span><br><span class="line">            &quot;max&quot;: &#123;</span><br><span class="line">                &quot;field&quot;: &quot;price&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-6-2-桶聚合"><a href="#4-6-2-桶聚合" class="headerlink" title="4.6.2 桶聚合"></a>4.6.2 桶聚合</h4><p>1）统计品牌为万豪下有哪些星级</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">## 统计品牌为万豪下有哪些星级</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">       &quot;term&quot;: &#123;</span><br><span class="line">           &quot;brand&quot;: &quot;万豪&quot;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;my_group&quot;: &#123;</span><br><span class="line">            &quot;terms&quot;: &#123;</span><br><span class="line">                &quot;field&quot;: &quot;specs&quot;,</span><br><span class="line">                &quot;size&quot;: 5</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）根据搜索条件对品牌分组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">## 根据搜索条件对品牌分组</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">       &quot;query_string&quot;: &#123;</span><br><span class="line">           &quot;fields&quot;: [&quot;name&quot;, &quot;synopsis&quot;, &quot;area&quot;, &quot;address&quot;],</span><br><span class="line">           &quot;query&quot;: &quot;三亚 OR 商务&quot;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;hotel_brand&quot;: &#123;</span><br><span class="line">            &quot;terms&quot;: &#123;</span><br><span class="line">                &quot;field&quot;: &quot;brand&quot;,</span><br><span class="line">                &quot;size&quot;: 100</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-6-3-示例"><a href="#4-6-3-示例" class="headerlink" title="4.6.3 示例"></a>4.6.3 示例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">## 自定义时间段统计某品牌下酒店销量</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;createTime&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: &quot;2016-01-01&quot;,</span><br><span class="line">        &quot;lte&quot;: &quot;2021-01-01&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;hotel_brand&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;,</span><br><span class="line">        &quot;size&quot;: 100</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;sale_count&quot;: &#123;</span><br><span class="line">          &quot;sum&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;salesVolume&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-ElasticSearch实战技巧"><a href="#5-ElasticSearch实战技巧" class="headerlink" title="5. ElasticSearch实战技巧"></a>5. ElasticSearch实战技巧</h2><h3 id="5-1-优化多字段查询"><a href="#5-1-优化多字段查询" class="headerlink" title="5.1 优化多字段查询"></a>5.1 优化多字段查询</h3><p>搜索时，对于每条搜索结果ES都会对其按照匹配度进行打分，分数越高，在结果中排名越靠前。</p>
<p>在ES中提供了两种设置权重的方式：索引设置、查询设置。</p>
<p>索引设置：创建索引时配置权重，该方式应用较少，因为一旦需求发生改变，则需要重新创建索引。</p>
<p>查询设置：在查询时，根据需求灵活的配置权重，该方式使用最多。</p>
<h4 id="5-1-1-提升字段查询得分"><a href="#5-1-1-提升字段查询得分" class="headerlink" title="5.1.1 提升字段查询得分"></a>5.1.1 提升字段查询得分</h4><p>将name字段查询比重提升10倍</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;explain&quot;: true, </span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;multi_match&quot;:&#123;</span><br><span class="line">      &quot;query&quot;: &quot;北京金龙&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;name^10&quot;, &quot;address&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-综合提升字段查询得分"><a href="#5-1-2-综合提升字段查询得分" class="headerlink" title="5.1.2 综合提升字段查询得分"></a>5.1.2 综合提升字段查询得分</h4><p>tie_breaker：将其他query的分数也考虑进去（最大值加上其他值的0.3倍）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;explain&quot;: true, </span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;multi_match&quot;:&#123;</span><br><span class="line">      &quot;query&quot;: &quot;北京金龙&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;name&quot;, &quot;address&quot;],</span><br><span class="line">      &quot;tie_breaker&quot;: 0.3</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 tie_breaker 和不使用tie_breaker ，查询出来的某一条数据的 _score 分数，会有相应的提高，例如：</p>
<blockquote>
<p>name中包含关键词matched query 的得分，假设是 0.1984226</p>
<p>address中包含关键词matched query的得分，假设是 12.07466</p>
</blockquote>
<p>添加了 tie_breaker = 0.3，那么就是这样的了， 0.1984226 * 0.3 + 12.07466 = 12.13418678；</p>
<p>大于最高一条的得分12.07466，这样搜索的关联性就提升上去了， 更为合理。</p>
<h4 id="5-1-3-自定义评分"><a href="#5-1-3-自定义评分" class="headerlink" title="5.1.3 自定义评分"></a>5.1.3 自定义评分</h4><p>1）创建索引时设置权重</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">## 查询多域展示相关结果数据</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">       &quot;query_string&quot;: &#123;</span><br><span class="line">           &quot;fields&quot;: [&quot;name&quot;, &quot;synopsis&quot;, &quot;area&quot;, &quot;address&quot;],</span><br><span class="line">           &quot;query&quot;: &quot;北京市万豪spa三星&quot;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## 评分扩大10倍</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">       &quot;query_string&quot;: &#123;</span><br><span class="line">           &quot;fields&quot;: [&quot;name&quot;, &quot;synopsis&quot;, &quot;area&quot;, &quot;address&quot;],</span><br><span class="line">           &quot;query&quot;: &quot;北京市万豪spa三星&quot;,</span><br><span class="line">           &quot;boost&quot;: 10</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2）查询设置权重</p>
<p>function_score</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">## 为品牌为万豪的酒店，权重值增加50倍</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">       &quot;function_score&quot;: &#123;</span><br><span class="line">           &quot;query&quot;: &#123;</span><br><span class="line">               &quot;query_string&quot;: &#123;</span><br><span class="line">                    &quot;fields&quot;: [&quot;name&quot;, &quot;synopsis&quot;, &quot;area&quot;, &quot;address&quot;],</span><br><span class="line">                     &quot;query&quot;: &quot;北京市万豪spa三星&quot;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;,</span><br><span class="line">           &quot;functions&quot;: [</span><br><span class="line">               &#123;</span><br><span class="line">                   &quot;filter&quot;: &#123;</span><br><span class="line">                       &quot;term&quot;: &#123;</span><br><span class="line">                           &quot;brand&quot;: &quot;万豪&quot;</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;,</span><br><span class="line">                   &quot;weight&quot;: 50</span><br><span class="line">               &#125;</span><br><span class="line">           ]</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">## 将广告酒店的权重增加100倍，使其靠前</span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;function_score&quot;: &#123;</span><br><span class="line">            &quot;query&quot;: &#123;</span><br><span class="line">                &quot;query_string&quot;: &#123;</span><br><span class="line">                    &quot;fields&quot;: [&quot;name&quot;, &quot;synopsis&quot;, &quot;area&quot;, &quot;address&quot;],</span><br><span class="line">                    &quot;query&quot;: &quot;北京市万豪spa三星&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">    &quot;query&quot;: &#123;</span><br><span class="line">        &quot;function_score&quot;: &#123;</span><br><span class="line">            &quot;query&quot;: &#123;</span><br><span class="line">                &quot;query_string&quot;: &#123;</span><br><span class="line">                    &quot;fields&quot;: [&quot;name&quot;, &quot;synopsis&quot;, &quot;area&quot;, &quot;address&quot;],</span><br><span class="line">                    &quot;query&quot;: &quot;北京市万豪spa三星&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;functions&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;filter&quot;: &#123;</span><br><span class="line">                        &quot;term&quot;: &#123;</span><br><span class="line">                            &quot;isAd&quot;: &quot;1&quot;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;weight&quot;: 100</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-全量索引构建"><a href="#5-2-全量索引构建" class="headerlink" title="5.2 全量索引构建"></a>5.2 全量索引构建</h3><h4 id="5-21-下载logstash"><a href="#5-21-下载logstash" class="headerlink" title="5.21 下载logstash"></a>5.21 下载logstash</h4><p>下载地址：<a target="_blank" rel="noopener" href="https://artifacts.elastic.co/downloads/logstash/logstash-7.10.2-linux-x86_64.tar.gz">https://artifacts.elastic.co/downloads/logstash/logstash-7.10.2-linux-x86_64.tar.gz</a></p>
<h4 id="5-2-2-安装logstash-input-jdbc插件"><a href="#5-2-2-安装logstash-input-jdbc插件" class="headerlink" title="5.2.2 安装logstash-input-jdbc插件"></a>5.2.2 安装logstash-input-jdbc插件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/logstash-plugin install logstash-input-jdbc</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-配置mysql驱动包"><a href="#5-2-3-配置mysql驱动包" class="headerlink" title="5.2.3 配置mysql驱动包"></a>5.2.3 配置mysql驱动包</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@linux30 logstash-7.10.2]# mkdir mysql</span><br><span class="line">[root@linux30 logstash-7.10.2]# cd mysql/</span><br><span class="line">[root@linux30 mysql]# ll</span><br><span class="line">总用量 2344</span><br><span class="line">-rw-r--r-- 1 root root 2397321 4月  11 14:12 mysql-connector-java-8.0.21.jar</span><br></pre></td></tr></table></figure>

<h4 id="5-2-4-配置JDBC连接"><a href="#5-2-4-配置JDBC连接" class="headerlink" title="5.2.4 配置JDBC连接"></a>5.2.4 配置JDBC连接</h4><p>创建索引数据是从mysql中通过select语句查询， 然后再通过logstash-input-jdbc的配置文件方式导入 elasticsearch中。</p>
<p>在/opt/elasticsearch/logstash-7.10.2/mysql/full-sync目录创建jdbc.conf与jdbc.sql文件。</p>
<p>jdbc.conf文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    stdin &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    jdbc &#123;</span><br><span class="line">        # mysql 数据库链接,users为数据库名</span><br><span class="line">        jdbc_connection_string =&gt; &quot;jdbc:mysql://192.168.10.30:3306/elasticsearch_db&quot;</span><br><span class="line">        # 用户名和密码</span><br><span class="line">        jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">        jdbc_password =&gt; &quot;123456&quot;</span><br><span class="line">        # 驱动</span><br><span class="line">        jdbc_driver_library =&gt; &quot;/opt/elasticsearch/logstash-7.10.2/mysql/mysql-connector-java-8.0.21.jar&quot;</span><br><span class="line">        # 驱动类名</span><br><span class="line">        jdbc_driver_class =&gt; &quot;com.mysql.cj.jdbc.Driver&quot;</span><br><span class="line">        jdbc_paging_enabled =&gt; &quot;true&quot;</span><br><span class="line">        jdbc_page_size =&gt; &quot;50000&quot;</span><br><span class="line">        # 执行的sql 文件路径+名称</span><br><span class="line">        statement_filepath =&gt; &quot;/opt/elasticsearch/logstash-7.10.2/mysql/full-sync/jdbc.sql&quot;</span><br><span class="line">        # 设置监听间隔 各字段含义（由左至右）分、时、天、月、年，全部为*默认含义为每分钟都更新</span><br><span class="line">        schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">                #ES的连接信息</span><br><span class="line">                hosts =&gt; [&quot;192.168.10.30:9200&quot;]</span><br><span class="line">                #索引名称</span><br><span class="line">                index =&gt; &quot;hotel&quot;</span><br><span class="line">                document_type =&gt; &quot;_doc&quot;</span><br><span class="line">                #自增ID， 需要关联的数据库的ID字段， 对应索引的ID标识</span><br><span class="line">                document_id =&gt; &quot;%&#123;id&#125;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        stdout &#123;</span><br><span class="line">                #JSON格式输出</span><br><span class="line">                codec =&gt; json_lines</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>jdbc.sql文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">        id,</span><br><span class="line">        NAME,</span><br><span class="line">        address,</span><br><span class="line">        brand,</span><br><span class="line">        type,</span><br><span class="line">        price,</span><br><span class="line">        specs,</span><br><span class="line">        salesVolume,</span><br><span class="line">        synopsis,</span><br><span class="line">        area,</span><br><span class="line">        imageUrl,</span><br><span class="line">        createTime,</span><br><span class="line">        isAd</span><br><span class="line">FROM</span><br><span class="line">        t_hotel</span><br></pre></td></tr></table></figure>

<h4 id="5-2-5-执行全量同步"><a href="#5-2-5-执行全量同步" class="headerlink" title="5.2.5 执行全量同步"></a>5.2.5 执行全量同步</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@linux30 full-sync]# ../../bin/logstash -f jdbc.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-2-6-检查结果"><a href="#5-2-6-检查结果" class="headerlink" title="5.2.6 检查结果"></a>5.2.6 检查结果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET hotel/_search</span><br></pre></td></tr></table></figure>

<h3 id="5-3-增量索引同步"><a href="#5-3-增量索引同步" class="headerlink" title="5.3 增量索引同步"></a>5.3 增量索引同步</h3><h4 id="5-3-1-修改jdbc-conf配置文件"><a href="#5-3-1-修改jdbc-conf配置文件" class="headerlink" title="5.3.1 修改jdbc.conf配置文件"></a>5.3.1 修改jdbc.conf配置文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    stdin &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    jdbc &#123;</span><br><span class="line">        # mysql 数据库链接,users为数据库名</span><br><span class="line">        jdbc_connection_string =&gt; &quot;jdbc:mysql://192.168.10.30:3306/elasticsearch_db&quot;</span><br><span class="line">        # 用户名和密码</span><br><span class="line">        jdbc_user =&gt; &quot;root&quot;</span><br><span class="line">        jdbc_password =&gt; &quot;123456&quot;</span><br><span class="line">        # 驱动</span><br><span class="line">        jdbc_driver_library =&gt; &quot;/opt/elasticsearch/logstash-7.10.2/mysql/mysql-connector-java-8.0.21.jar&quot;</span><br><span class="line">        # 驱动类名</span><br><span class="line">        jdbc_driver_class =&gt; &quot;com.mysql.cj.jdbc.Driver&quot;</span><br><span class="line">        jdbc_paging_enabled =&gt; &quot;true&quot;</span><br><span class="line">        jdbc_page_size =&gt; &quot;50000&quot;</span><br><span class="line">        # 执行的sql 文件路径+名称</span><br><span class="line">        statement_filepath =&gt; &quot;/opt/elasticsearch/logstash-7.10.2/mysql/inc-sync/jdbc.sql&quot;</span><br><span class="line">        # 设置监听间隔 各字段含义（由左至右）分、时、天、月、年，全部为*默认含义为每分钟都更新</span><br><span class="line">        schedule =&gt; &quot;* * * * *&quot;</span><br><span class="line">        #设置timezone</span><br><span class="line">        jdbc_default_timezone =&gt; &quot;Asia/Shanghai&quot;</span><br><span class="line">        # 增量同步属性标识</span><br><span class="line">        last_run_metadata_path =&gt; &quot;/opt/elasticsearch/logstash-7.10.2/mysql/inc-sync/last_value&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">                #ES的连接信息</span><br><span class="line">                hosts =&gt; [&quot;192.168.10.30:9200&quot;]</span><br><span class="line">                #索引名称</span><br><span class="line">                index =&gt; &quot;hotel&quot;</span><br><span class="line">                document_type =&gt; &quot;_doc&quot;</span><br><span class="line">                #自增ID， 需要关联的数据库的ID字段， 对应索引的ID标识</span><br><span class="line">                document_id =&gt; &quot;%&#123;id&#125;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        stdout &#123;</span><br><span class="line">                #JSON格式输出</span><br><span class="line">                codec =&gt; json_lines</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-3-2-修改jdbc-sql配置文件"><a href="#5-3-2-修改jdbc-sql配置文件" class="headerlink" title="5.3.2 修改jdbc.sql配置文件"></a>5.3.2 修改jdbc.sql配置文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">        id,</span><br><span class="line">        NAME,</span><br><span class="line">        address,</span><br><span class="line">        brand,</span><br><span class="line">        type,</span><br><span class="line">        price,</span><br><span class="line">        specs,</span><br><span class="line">        salesVolume,</span><br><span class="line">        synopsis,</span><br><span class="line">        area,</span><br><span class="line">        imageUrl,</span><br><span class="line">        createTime,</span><br><span class="line">        isAd</span><br><span class="line">FROM</span><br><span class="line">        t_hotel</span><br><span class="line">WHERE</span><br><span class="line">        createTime &gt;= :sql_last_value</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-3-3-创建同步最后记录时间"><a href="#5-3-3-创建同步最后记录时间" class="headerlink" title="5.3.3 创建同步最后记录时间"></a>5.3.3 创建同步最后记录时间</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /opt/elasticsearch/logstash-7.10.2/mysql/inc-sync/last_value</span><br></pre></td></tr></table></figure>

<p>给定一个初始的时间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2022-04-12 00:00:00</span><br></pre></td></tr></table></figure>

<h4 id="5-3-4-验证"><a href="#5-3-4-验证" class="headerlink" title="5.3.4 验证"></a>5.3.4 验证</h4><p>启动logstash， 会根据初始时间，加载对应的数据。</p>
<p>如果修改的数据的更新时间， 会自动检测， 同步增量的数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MySQL [elasticsearch_db]&gt; insert into elasticsearch_db.t_hotel (name, address, brand, type, price, specs, salesVolume, synopsis, area, imageUrl, createTime, isAd) values (&quot;test hotel&quot;,&quot;test address&quot;, &quot;test brand&quot;, &quot;test type&quot;, 100, &quot;test specs&quot;, 100, &quot;test data&quot;, &quot;test data&quot;, &quot;www.baidu.com&quot;, &quot;2022-06-17&quot;, 1);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET hotel/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;test hotel&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/11/18/Es%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BD%BF%E7%94%A8/" data-id="claqud9ka00027ctdcz3z0byb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2022/11/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">计算机原理</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/11/18/Es%E5%8E%9F%E7%90%86%E4%B8%8E%E4%BD%BF%E7%94%A8/">Es原理与使用</a>
          </li>
        
          <li>
            <a href="/2022/11/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/">计算机原理</a>
          </li>
        
          <li>
            <a href="/2022/11/07/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>